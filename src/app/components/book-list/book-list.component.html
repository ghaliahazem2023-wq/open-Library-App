<!-- src/app/components/book-list/book-list.component.html -->
<!-- Page principale : hero, recherche avancÃ©e et grille de livres. -->

<main class="book-list-container">
  <!-- Section hÃ©ro -->
  <app-hero-section></app-hero-section>

  <!-- Barre de recherche avancÃ©e -->
  <app-search-bar (search)="onSearch($event)"></app-search-bar>

  <!-- Affichage du message de chargement si isLoading est true -->
  <p *ngIf="isLoading" class="info-message">
    Chargement des livres...
  </p>

  <!-- Affichage du message d'erreur si errorMessage n'est pas null -->
  <p *ngIf="!isLoading && errorMessage" class="error-message">
    {{ errorMessage }}
  </p>

  <!-- Si pas d'erreur et pas de chargement, on affiche la grille -->
  <section *ngIf="!isLoading && !errorMessage">
    <!-- Si la liste est vide, on affiche un message d'information -->
    <p *ngIf="booksList.length === 0" class="info-message">
      Aucun livre trouvÃ© pour ces critÃ¨res.
    </p>

    <!-- Grille de livres -->
    <div id="books-grid" class="books-grid" *ngIf="booksList.length > 0">
      <!-- On parcourt la liste de livres avec *ngFor -->
      <article
        class="book-card"
        *ngFor="let book of booksList"
        (click)="goToDetails(book)"
      >
        <div class="book-card-image-wrapper">
          <img
            [src]="getCoverUrl(book)"
            [alt]="book.title"
          />
          <div class="book-badges">
            <span *ngFor="let badge of getBadges(book)" class="badge">
              {{ badge }}
            </span>
          </div>
        </div>

        <div class="book-info">
          <h2>{{ book.title }}</h2>
          <p *ngIf="book.first_publish_year">
            PremiÃ¨re publication : {{ book.first_publish_year }}
          </p>
          <p *ngIf="book.edition_count">
            Nombre d'Ã©ditions : {{ book.edition_count }}
          </p>
        </div>

        <div class="book-extra">
          <div class="rating">
            <span
              *ngFor="let star of getStars(book); let i = index"
              class="star"
              [class.filled]="i < getRating(book)"
            >
              â˜…
            </span>
          </div>
          <div class="quick-actions">
            <button type="button" class="icon-btn" (click)="downloadBook(book); $event.stopPropagation()" [attr.aria-disabled]="downloadingKeys.has(book.key)" [title]="downloadingKeys.has(book.key) ? 'TÃ©lÃ©chargementâ€¦' : 'TÃ©lÃ©charger ce livre'">
              <span *ngIf="!downloadingKeys.has(book.key)">ðŸ“¥</span>
              <span *ngIf="downloadingKeys.has(book.key)" class="small-spinner" aria-hidden="true"></span>
            </button>
          </div>
        </div>
      </article>
    </div>
  </section>
</main>

